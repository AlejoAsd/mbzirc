name: integration_tests

on: [push]

jobs:
  integration_tests:
    runs-on: ubuntu-20.04 # linux required if you want to use docker
    steps:
      - name: Check out code
        uses: actions/checkout@v2
      - name: Install dri packages
        run: sudo apt-get install -y libxcb-dri3-0 libxcb-dri2-0 mesa-utils and libgl1-mesa-glx xvfb
      - name: xvfb
        run: 'Xvfb :1 -ac -noreset -core -screen 0 1280x1024x24 &'
      - name: Check DRI in dev
        run: ls -lasR /dev/dri*
      - name: Compile and run tests
        run: docker build --device /dev/dri:/dev/dri -v /tmp/.X11-unix:/tmp/.X11-unix -e DISPLAY=:1.0 -t mbzirc_sim . -f docker/tests/Dockerfile
